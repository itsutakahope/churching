# Google Apps Script 整合測試計劃

**測試日期**: 2025-11-14
**測試範圍**: 採購板系統 - 前後端整合測試
**測試環境**: Google Apps Script Web App

---

## 📋 測試概覽

### 測試目標
- 驗證所有 API 端點正常運作
- 確認前後端資料流通順暢
- 檢查 UI 互動功能完整性
- 驗證權限控制正確性
- 測試 PDF 生成功能
- 確認錯誤處理機制

### 測試範圍
- ✅ 26 個 API 端點
- ✅ 5 個模態框
- ✅ 8 個核心功能模組
- ✅ 3 種 PDF 生成類型

---

## 🧪 測試項目

### 1. 身份驗證與授權測試

#### 1.1 Google OAuth 登入
- [ ] **測試 1.1.1**: 未登入使用者訪問 → 顯示登入頁面
- [ ] **測試 1.1.2**: Google 帳號登入 → 自動建立使用者記錄
- [ ] **測試 1.1.3**: 首次登入使用者 → 顯示等待批准頁面
- [ ] **測試 1.1.4**: 已批准使用者 → 顯示主頁面

**預期結果**:
- 未批准使用者無法存取主要功能
- 使用者資料正確儲存到 Users 工作表
- 使用者角色正確設定

#### 1.2 權限控制
- [ ] **測試 1.2.1**: 一般使用者無法存取管理員功能
- [ ] **測試 1.2.2**: 財務人員可以存取財務相關功能
- [ ] **測試 1.2.3**: 管理員可以存取所有功能

---

### 2. 採購需求管理測試

#### 2.1 新增採購需求
**API**: `createRequirement`

**測試步驟**:
1. 點擊「新增採購需求」按鈕
2. 填寫表單：
   - 品項: "測試品項 - 影印紙"
   - 規格說明: "A4 白色影印紙 70磅"
   - 會計科目: "2.3.1 文具印刷"
   - 優先級: "一般"
3. 提交表單

**驗證點**:
- [ ] 模態框正確開啟
- [ ] 表單驗證正常（必填欄位）
- [ ] API 回應成功
- [ ] 新需求出現在列表中
- [ ] 資料正確儲存到 Requirements 工作表
- [ ] 顯示成功 Toast 通知

#### 2.2 編輯採購需求
**API**: `updateRequirement`

**測試步驟**:
1. 在列表中點擊採購需求的「編輯」按鈕
2. 修改品項名稱為 "測試品項 - 影印紙（已修改）"
3. 提交表單

**驗證點**:
- [ ] 模態框正確載入現有資料
- [ ] 修改成功
- [ ] 列表中資料即時更新
- [ ] Google Sheets 中資料正確更新
- [ ] 只有建立者可以編輯自己的需求

#### 2.3 查看詳情
**API**: `getRequirement`, `getComments`

**測試步驟**:
1. 點擊採購需求卡片
2. 查看詳情模態框

**驗證點**:
- [ ] 所有資訊正確顯示
- [ ] 留言列表正確載入
- [ ] 深色模式下樣式正常

#### 2.4 標記已購買
**API**: `updateRequirement`, `getReimbursementContacts`

**測試步驟**:
1. 點擊「標記已購買」按鈕
2. 填寫購買資訊：
   - 購買金額: 500
   - 購買日期: 2025-11-14
   - 購買人: （自動填入）
   - 報帳人: 選擇一位報帳聯絡人
   - 購買備註: "已在實體店面購買"
3. 提交表單

**驗證點**:
- [ ] 報帳聯絡人清單正確載入
- [ ] 狀態更新為「已購買」
- [ ] 購買資訊正確儲存
- [ ] 卡片樣式更新（顯示綠色徽章）

#### 2.5 轉移報帳人
**API**: `transferReimbursement`

**測試步驟**:
1. 點擊「轉移報帳人」按鈕
2. 選擇新的報帳人
3. 確認轉移

**驗證點**:
- [ ] 目前報帳人正確顯示
- [ ] 可選擇的報帳人清單正確
- [ ] 轉移成功
- [ ] 資料正確更新

#### 2.6 刪除採購需求
**API**: `deleteRequirement`

**測試步驟**:
1. 點擊「刪除」按鈕
2. 確認刪除

**驗證點**:
- [ ] 顯示確認對話框
- [ ] 刪除成功
- [ ] 需求從列表中移除
- [ ] Google Sheets 中資料刪除
- [ ] 關聯的留言也被刪除
- [ ] 只有建立者可以刪除自己的需求

---

### 3. 留言系統測試

#### 3.1 新增留言
**API**: `addComment`

**測試步驟**:
1. 開啟詳情模態框
2. 在留言輸入框輸入 "這是測試留言"
3. 提交留言

**驗證點**:
- [ ] 留言即時顯示在列表中
- [ ] 留言資料正確儲存到 Comments 工作表
- [ ] 作者名稱正確顯示
- [ ] 時間戳記正確

#### 3.2 刪除留言
**API**: `deleteComment`

**測試步驟**:
1. 點擊留言的「刪除」按鈕
2. 確認刪除

**驗證點**:
- [ ] 留言即時從列表移除
- [ ] Google Sheets 中資料刪除
- [ ] 只有留言作者或管理員可以刪除

---

### 4. 搜尋與篩選測試

#### 4.1 搜尋功能

**測試步驟**:
1. 在搜尋框輸入 "影印紙"
2. 等待 300ms（debounce）

**驗證點**:
- [ ] 列表只顯示包含「影印紙」的需求
- [ ] 搜尋即時更新
- [ ] 支援中文搜尋

#### 4.2 狀態篩選

**測試步驟**:
1. 選擇狀態篩選 "已購買"
2. 查看列表

**驗證點**:
- [ ] 只顯示已購買的需求
- [ ] 篩選條件可以清除

#### 4.3 優先級篩選

**測試步驟**:
1. 選擇優先級篩選 "緊急"
2. 查看列表

**驗證點**:
- [ ] 只顯示緊急優先級的需求
- [ ] 緊急需求有明顯的視覺標示

#### 4.4 組合篩選

**測試步驟**:
1. 同時使用搜尋、狀態、優先級篩選
2. 查看結果

**驗證點**:
- [ ] 所有篩選條件同時生效
- [ ] 結果正確

---

### 5. PDF 生成測試

#### 5.1 單一採購需求 PDF
**API**: `generateRequirementPDF`

**測試步驟**:
1. 開啟詳情模態框
2. 點擊「下載 PDF」按鈕
3. 等待 PDF 生成

**驗證點**:
- [ ] 顯示「正在生成 PDF」通知
- [ ] PDF 成功生成
- [ ] 自動開啟下載連結
- [ ] PDF 包含完整資訊：
  - [ ] 基本資訊（品項、狀態、優先級等）
  - [ ] 規格說明
  - [ ] 購買資訊（如果已購買）
  - [ ] 留言記錄
- [ ] 中文字體正確顯示（Noto Sans TC）
- [ ] 表格樣式美觀
- [ ] PDF 檔案權限正確（任何人可檢視）

#### 5.2 摘要報告 PDF
**API**: `generateRequirementsSummaryPDF`

**測試步驟**:
1. 設定篩選條件（例如：狀態=已購買）
2. 點擊工具列的「匯出 PDF」按鈕
3. 等待 PDF 生成

**驗證點**:
- [ ] PDF 成功生成
- [ ] 包含統計摘要：
  - [ ] 總計數量
  - [ ] 各狀態數量
  - [ ] 總金額
- [ ] 包含詳細列表表格
- [ ] 只包含符合篩選條件的需求
- [ ] 報告日期正確

#### 5.3 批次生成 PDF（ZIP）
**API**: `generateMultipleRequirementsPDF`

**測試步驟**:
1. 選擇多個採購需求（使用 API 測試）
2. 呼叫批次生成 API
3. 等待 ZIP 生成

**驗證點**:
- [ ] ZIP 檔案成功生成
- [ ] 包含所有選中的 PDF
- [ ] 檔案命名正確
- [ ] 限制最多 50 個 PDF

---

### 6. UI/UX 測試

#### 6.1 視圖切換

**測試步驟**:
1. 點擊「列表視圖」按鈕
2. 點擊「網格視圖」按鈕

**驗證點**:
- [ ] 視圖正確切換
- [ ] 視圖狀態保持
- [ ] 兩種視圖資料一致

#### 6.2 深色模式

**測試步驟**:
1. 點擊深色模式切換按鈕
2. 檢查所有頁面元素

**驗證點**:
- [ ] 深色模式正確切換
- [ ] 所有元素顏色正確
- [ ] 模態框樣式正常
- [ ] 圖示顏色調整
- [ ] 偏好設定保存到 localStorage

#### 6.3 響應式設計

**測試步驟**:
1. 調整瀏覽器視窗大小
2. 測試手機、平板、桌面尺寸

**驗證點**:
- [ ] 手機版 (< 640px) 正常顯示
- [ ] 平板版 (640px - 1024px) 正常顯示
- [ ] 桌面版 (> 1024px) 正常顯示
- [ ] 工具列按鈕適當調整
- [ ] 模態框適應螢幕大小

#### 6.4 Toast 通知

**測試步驟**:
1. 執行各種操作觸發不同類型的通知

**驗證點**:
- [ ] Success 通知（綠色）
- [ ] Error 通知（紅色）
- [ ] Info 通知（藍色）
- [ ] Warning 通知（黃色）
- [ ] 通知自動消失
- [ ] 多個通知正確堆疊

---

### 7. 錯誤處理測試

#### 7.1 網路錯誤

**測試步驟**:
1. 模擬網路中斷
2. 執行 API 操作

**驗證點**:
- [ ] 顯示友善的錯誤訊息
- [ ] 不會導致頁面崩潰

#### 7.2 驗證錯誤

**測試步驟**:
1. 提交空白表單
2. 提交無效資料

**驗證點**:
- [ ] 必填欄位驗證正確
- [ ] 顯示驗證錯誤訊息
- [ ] 表單不會提交

#### 7.3 權限錯誤

**測試步驟**:
1. 使用一般使用者嘗試執行管理員操作
2. 嘗試編輯他人的採購需求

**驗證點**:
- [ ] 顯示權限不足錯誤
- [ ] 操作被阻止

---

### 8. 資料完整性測試

#### 8.1 並發操作

**測試步驟**:
1. 兩個使用者同時編輯同一個需求
2. 兩個使用者同時新增留言

**驗證點**:
- [ ] LockService 正確處理並發
- [ ] 資料不會遺失
- [ ] 資料不會衝突

#### 8.2 資料關聯

**測試步驟**:
1. 刪除採購需求
2. 檢查關聯的留言

**驗證點**:
- [ ] 刪除需求時，關聯留言也被刪除
- [ ] 資料關聯正確

#### 8.3 資料驗證

**測試步驟**:
1. 嘗試輸入無效資料
2. 檢查資料格式

**驗證點**:
- [ ] Email 格式驗證
- [ ] 日期格式驗證
- [ ] 數字格式驗證

---

## 🔧 測試工具

### 自動化測試腳本
- `gas-project/tests/APITests.gs` - API 端點測試
- `gas-project/tests/IntegrationTests.gs` - 整合測試

### 手動測試
- Google Chrome DevTools
- 不同螢幕尺寸測試
- 不同使用者角色測試

---

## ✅ 測試檢查清單

### API 測試（26 個端點）
- [ ] createRequirement
- [ ] getRequirements
- [ ] getRequirement
- [ ] updateRequirement
- [ ] deleteRequirement
- [ ] transferReimbursement
- [ ] getRequirementStatistics
- [ ] getMyRequirements
- [ ] getMyReimbursements
- [ ] addComment
- [ ] deleteComment
- [ ] getComments
- [ ] searchComments
- [ ] generateRequirementPDF
- [ ] generateRequirementsSummaryPDF
- [ ] generateMultipleRequirementsPDF
- [ ] getUsers
- [ ] getReimbursementContacts
- [ ] getFinanceStaff
- [ ] updateUser
- [ ] updateUserPreferences
- [ ] approveUser
- [ ] getCurrentUserProfile
- [ ] getUserInfo
- [ ] getSystemInfo
- [ ] healthCheck

### 前端功能測試
- [ ] 登入/登出
- [ ] 新增採購需求
- [ ] 編輯採購需求
- [ ] 刪除採購需求
- [ ] 標記已購買
- [ ] 轉移報帳人
- [ ] 查看詳情
- [ ] 新增留言
- [ ] 刪除留言
- [ ] 搜尋功能
- [ ] 狀態篩選
- [ ] 優先級篩選
- [ ] 視圖切換
- [ ] 深色模式
- [ ] 生成單一 PDF
- [ ] 生成摘要 PDF
- [ ] Toast 通知

---

## 📊 測試結果記錄

### 測試統計
- **總測試項目**: 待統計
- **通過**: 0
- **失敗**: 0
- **跳過**: 0
- **通過率**: 0%

### 發現的問題
（在測試過程中記錄）

### 建議改進
（在測試過程中記錄）

---

## 📝 測試報告

測試完成後將生成詳細的測試報告，包括：
- 測試執行摘要
- 通過/失敗統計
- 發現的錯誤列表
- 效能評估
- 改進建議

---

**測試負責人**: Claude
**測試狀態**: 準備中
**預計完成日期**: 2025-11-14
